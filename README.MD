# Типы связей в реляционной БД PostgresSQL с примерами

## -- 1 to many

DROP TABLE IF EXISTS director CASCADE ;


CREATE TaBLE Director(
director_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(100) NOT NULL UNIQUE ,
surname VARCHAR(100) NOT NULL,
age INTEGER NOT NULL CHECK ( age > 10) CHECK ( age < 100 )
);


SELECT * FROM director;

CREATE TABLE Movie (
movie_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
director_id INTEGER NOT NULL REFERENCES Director(director_id),
name VARCHAR(200) NOT NULL,
year_of_prodaction INTEGER CHECK ( year_of_prodaction > 1900 ) CHECK ( year_of_prodaction < 2025 ) NOT NULL
);
DROP TABLE IF EXISTS movie;
SELECT * FROM movie;

INSERT INTO Director (name, surname, age) VALUES ('John', 'Doe', 50);
INSERT INTO Director (name, surname, age) VALUES ('Johnaten', 'Doz', 99);
INSERT INTO Director (name, surname, age) VALUES ('Johny', 'Dol', 11);
INSERT INTO Director (name, surname, age) VALUES ('Johnas', 'Dok', 12);
INSERT INTO Director (name, surname, age) VALUES ('Johnes', 'Doj', 20);
INSERT INTO Director (name, surname, age) VALUES ('Johnan', 'Doh', 20);
INSERT INTO Director (name, surname, age) VALUES ('Johnidze', 'Dog', 30);
INSERT INTO Director (name, surname, age) VALUES ('Johnetti', 'Dof', 30);
INSERT INTO Director (name, surname, age) VALUES ('Johnevally', 'Dod', 45);

INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (1,'John', 1995);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (1,'Johnaten', 1999);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (2,'Johny', 1910);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (3,'Johnas', 2000);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (4,'Johnes', 2001);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (4,'Johnan', 2002);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (5,'Johnidze',2003);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (6,'Johnetti', 2023);
INSERT INTO movie (director_id, name, year_of_prodaction) VALUES (5,'Johnevally', 1945);


SELECT * FROM director JOIN movie on director.director_id = movie.director_id;
SELECT * FROM director LEFT JOIN movie on director.director_id = movie.director_id;

## -- 1 to 1


create table Citizen (
citizen_id int generated by default as identity primary key,
name varchar(100) not null ,
age int CHECK ( age > 0 )
);

create table Passport
(
citizen_id int PRIMARY KEY REFERENCES Citizen(citizen_id),
passport_number int NOT NULL UNIQUE
);


INSERT INTO citizen (name, age) VALUES  ('Rob', 10);
INSERT INTO citizen (name, age) VALUES  ('Hob', 13);
INSERT INTO citizen (name, age) VALUES  ('Dob', 15);
INSERT INTO citizen (name, age) VALUES  ('Bob', 20);

INSERT INTO passport (citizen_id, passport_number) VALUES (1, 345679);
INSERT INTO passport (citizen_id, passport_number) VALUES (2, 345677);
INSERT INTO passport (citizen_id, passport_number) VALUES (3, 345676);
INSERT INTO passport (citizen_id, passport_number) VALUES (4, 345675);


SELECT * FROM citizen;
SELECT * FROM passport;

SELECT name,passport_number FROM citizen JOIN passport P on citizen.citizen_id = P.citizen_id;
SELECT name,passport_number FROM citizen LEFT JOIN passport P on citizen.citizen_id = P.citizen_id;



## -- Many to many

Create table Actor (
actor_id INTEGER generated by default as IDENTITY PRIMARY KEY,
name varchar(100) not null unique,
age INTEGER CHECK(age > 0)
);

INSERT INTO Actor (name, age) VALUES ('Harley Keitel', 18);
INSERT INTO Actor (name, age) VALUES ('Robert De Nori', 19);
INSERT INTO Actor (name, age) VALUES ('Leonardo DiCapri', 20);
INSERT INTO Actor (name, age) VALUES ('Jason Stathan', 21);
INSERT INTO Actor (name, age) VALUES ('Joe Pesci', 22);
INSERT INTO Actor (name, age) VALUES ('Samuel L. Jackson', 23);

CREATE TABLE Actor_Movie(
actor_id INTEGER REFERENCES Actor(actor_id) ,
movie_id INTEGER REFERENCES Movie(movie_id) ,
PRIMARY KEY (actor_id,movie_id)
);

INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (1, 8);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (1, 9);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (2, 5);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (2, 6);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (3, 4);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (3, 7);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (3, 11);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (4, 8);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (4, 9);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (5, 6);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (6, 6);
INSERT INTO Actor_Movie (actor_id, movie_id) VALUES (6, 7);

driver_class=org.postgresql.Driver
connection.url=jdbc:postgresql://localhost:5432/first_db
connection.username=postgres
connection.password=1Z2x3c4v

dialect=org.hibernate.dialect.PostgreSQL10Dialect
show_sql=true


select Actor.name , Movie.name FROM Actor JOIN Actor_Movie AM on Actor.actor_id = AM.actor_id JOIN movie
ON AM.movie_id = Movie.movie_id;

////////////////////////////////////////////////////////////////
OPTIONAL<Person> in method show() for PerdonDAO ? не позволяет обновить юзера без изменения почты
////////////////////////////////////////////////////////////////
